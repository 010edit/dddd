[

![VampireXRay](https://miro.medium.com/v2/resize:fill:88:88/1*svMQb7ckvRrKV5bV8KIxjg.jpeg)



](https://medium.com/@VampireXRay?source=post_page---byline--0e91ea37eaa2--------------------------------)

**Unlocking Hidden Secrets: A Malware Analyst’s Journey with FindCrypt3 Plugin**

## Introduction

In the world of malware analysis, identifying cryptographic routines embedded in malware is crucial for extracting hidden configurations, decrypting payloads, and understanding the malware’s operational intent. One powerful tool in a malware analyst’s arsenal is the **FindCrypt3 plugin** for IDA Pro. This article details my experience downloading, configuring, and testing the FindCrypt3 plugin, along with the challenges faced and how I overcame them. Additionally, I will highlight the tangible benefits that this plugin offers for malware analysis.

## Downloading and Installing FindCrypt3

The journey began with downloading the **FindCrypt3** plugin, an IDA Pro extension designed to identify hardcoded cryptographic constants (such as AES S-Boxes) in malware binaries. The plugin can be found in public GitHub repositories or through IDA community sources.

**Steps to Download:**

1.  Navigate to the [FindCrypt3 GitHub repository](https://github.com/polymorf/findcrypt3).
2.  Clone the repository using:

```
<span id="9d8f" data-selectable-paragraph="">git <span>clone</span> https://github.com/polymorf/findcrypt3.git</span>
```

3\. Alternatively, download the ZIP file and extract it to your desired directory.

**Installation Process:**

1.  Copy the extracted **findcrypt3.py** and **findcrypt3.rules** files to the **IDA Pro plugin directory** (usually located at `C:\Program Files\IDA Pro\plugins`).
2.  Ensure the file structure resembles:

```
<span id="4845" data-selectable-paragraph=""><span>C:\Program Files\IDA Pro\plugins\findcrypt3.py</span><br><span>C:\Program Files\IDA Pro\plugins\findcrypt3.rules</span></span>
```

-   Restart IDA Pro to load the new plugin.

## Errors Encountered and Solutions

**1\. Python Configuration Error:**  
Upon launching IDA Pro, I was greeted with the following error:

```
<span id="e2a4" data-selectable-paragraph=""><span>WARNING:</span> Python <span>3</span> <span>is</span> <span>not</span> configured (Python3TargetDLL value <span>is</span> <span>not</span> <span>set</span>).<br>Please run idapyswitch <span>to</span> <span>select</span> a Python <span>3</span> install.</span>
```

**Solution:**

-   Download and install Python 3 from [python.org](https://www.python.org/downloads/).
-   Make sure it the verision suitable for ida verision.
-   Run the following command to set the Python path:

```
<span id="9e3f" data-selectable-paragraph="">idapyswitch.<span>exe</span></span>
```

-   Choose the Python 3 executable path when prompted.

**2\. Invalid Win32 Application Error:**  
Another issue occurred when IDA attempted to load `idapython3.dll`:

```
<span id="08f3" data-selectable-paragraph=""><span>LoadLibrary</span>(<span>C</span>:\Program Files\IDA Pro\plugins\idapython3.dll) <span>error</span>: %<span>1</span> <span>is</span> <span>not</span> <span>a</span> <span>valid</span> <span>Win32</span> <span>application</span>.</span>
```

**Solution:**

-   This error indicated a mismatch between the plugin’s architecture and IDA Pro’s version (32-bit vs 64-bit).
-   I ensured the correct Python version (64-bit) was installed, matching the 64-bit version of IDA Pro.
-   Reinstalled the correct `idapython3.dll` and placed it in the `plugins` directory.

**3\. YARA Module Not Found Error:**  
Running the plugin revealed another issue:

```
<span id="773e" data-selectable-paragraph="">Traceback (most recent <span>call</span> <span>last</span>):<br>  File "C:\Program Files\IDA Pro\plugins\findcrypt3.py", line <span>9</span>, <span>in</span> <span>&lt;</span><span>module</span><span>&gt;</span><br>    import yara<br>ModuleNotFoundError: <span>No</span> <span>module</span> named <span>'yara'</span></span>
```

**Solution:**

-   Installed the `yara-python` module:

```
<span id="2c7c" data-selectable-paragraph="">pip install yara-python</span>
```

-   Restarted IDA Pro, resolving the missing module issue.

## Testing the Plugin

With FindCrypt3 successfully installed, I proceeded to test the plugin by analyzing a suspected malware sample.

**Test Case:**  
I analyzed a simple C program that includes the AES S-Box to test the `findcrypt-yara` plugin in IDA Pro. This binary will contain known cryptographic constants that `findcrypt-yara` should detect.

## 1\. Create the C File (`test_crypto.c`)

```
<span id="610f" data-selectable-paragraph=""><span>#<span>include</span> <span>&lt;stdio.h&gt;</span></span><br><br><span>unsigned</span> <span>char</span> aes_sbox[<span>256</span>] = {<br>    <span>0x63</span>, <span>0x7c</span>, <span>0x77</span>, <span>0x7b</span>, <span>0xf2</span>, <span>0x6b</span>, <span>0x6f</span>, <span>0xc5</span>,<br>    <span>0x30</span>, <span>0x01</span>, <span>0x67</span>, <span>0x2b</span>, <span>0xfe</span>, <span>0xd7</span>, <span>0xab</span>, <span>0x76</span>,<br>    <span>0xca</span>, <span>0x82</span>, <span>0xc9</span>, <span>0x7d</span>, <span>0xfa</span>, <span>0x59</span>, <span>0x47</span>, <span>0xf0</span>,<br>    <span>0xad</span>, <span>0xd4</span>, <span>0xa2</span>, <span>0xaf</span>, <span>0x9c</span>, <span>0xa4</span>, <span>0x72</span>, <span>0xc0</span>,<br>    <span>0xb7</span>, <span>0xfd</span>, <span>0x93</span>, <span>0x26</span>, <span>0x36</span>, <span>0x3f</span>, <span>0xf7</span>, <span>0xcc</span>,<br>    <span>0x34</span>, <span>0xa5</span>, <span>0xe5</span>, <span>0xf1</span>, <span>0x71</span>, <span>0xd8</span>, <span>0x31</span>, <span>0x15</span>,<br>    <span>0x04</span>, <span>0xc7</span>, <span>0x23</span>, <span>0xc3</span>, <span>0x18</span>, <span>0x96</span>, <span>0x05</span>, <span>0x9a</span>,<br>    <span>0x07</span>, <span>0x12</span>, <span>0x80</span>, <span>0xe2</span>, <span>0xeb</span>, <span>0x27</span>, <span>0xb2</span>, <span>0x75</span>,<br>    <span>0x09</span>, <span>0x83</span>, <span>0x2c</span>, <span>0x1a</span>, <span>0x1b</span>, <span>0x6e</span>, <span>0x5a</span>, <span>0xa0</span>,<br>    <span>0x52</span>, <span>0x3b</span>, <span>0xd6</span>, <span>0xb3</span>, <span>0x29</span>, <span>0xe3</span>, <span>0x2f</span>, <span>0x84</span>,<br>    <span>0x53</span>, <span>0xd1</span>, <span>0x00</span>, <span>0xed</span>, <span>0x20</span>, <span>0xfc</span>, <span>0xb1</span>, <span>0x5b</span>,<br>    <span>0x6a</span>, <span>0xcb</span>, <span>0xbe</span>, <span>0x39</span>, <span>0x4a</span>, <span>0x4c</span>, <span>0x58</span>, <span>0xcf</span>,<br>    <span>0xd0</span>, <span>0xef</span>, <span>0xaa</span>, <span>0xfb</span>, <span>0x43</span>, <span>0x4d</span>, <span>0x33</span>, <span>0x85</span>,<br>    <span>0x45</span>, <span>0xf9</span>, <span>0x02</span>, <span>0x7f</span>, <span>0x50</span>, <span>0x3c</span>, <span>0x9f</span>, <span>0xa8</span>,<br>    <span>0x51</span>, <span>0xa3</span>, <span>0x40</span>, <span>0x8f</span>, <span>0x92</span>, <span>0x9d</span>, <span>0x38</span>, <span>0xf5</span>,<br>    <span>0xbc</span>, <span>0xb6</span>, <span>0xda</span>, <span>0x21</span>, <span>0x10</span>, <span>0xff</span>, <span>0xf3</span>, <span>0xd2</span>,<br>    <span>0xcd</span>, <span>0x0c</span>, <span>0x13</span>, <span>0xec</span>, <span>0x5f</span>, <span>0x97</span>, <span>0x44</span>, <span>0x17</span>,<br>    <span>0xc4</span>, <span>0xa7</span>, <span>0x7e</span>, <span>0x3d</span>, <span>0x64</span>, <span>0x5d</span>, <span>0x19</span>, <span>0x73</span>,<br>    <span>0x60</span>, <span>0x81</span>, <span>0x4f</span>, <span>0xdc</span>, <span>0x22</span>, <span>0x2a</span>, <span>0x90</span>, <span>0x88</span>,<br>    <span>0x46</span>, <span>0xee</span>, <span>0xb8</span>, <span>0x14</span>, <span>0xde</span>, <span>0x5e</span>, <span>0x0b</span>, <span>0xdb</span>,<br>    <span>0xe0</span>, <span>0x32</span>, <span>0x3a</span>, <span>0x0a</span>, <span>0x49</span>, <span>0x06</span>, <span>0x24</span>, <span>0x5c</span>,<br>    <span>0xc2</span>, <span>0xd3</span>, <span>0xac</span>, <span>0x62</span>, <span>0x91</span>, <span>0x95</span>, <span>0xe4</span>, <span>0x79</span>,<br>    <span>0xe7</span>, <span>0xc8</span>, <span>0x37</span>, <span>0x6d</span>, <span>0x8d</span>, <span>0xd5</span>, <span>0x4e</span>, <span>0xa9</span>,<br>    <span>0x6c</span>, <span>0x56</span>, <span>0xf4</span>, <span>0xea</span>, <span>0x65</span>, <span>0x7a</span>, <span>0xae</span>, <span>0x08</span>,<br>    <span>0xba</span>, <span>0x78</span>, <span>0x25</span>, <span>0x2e</span>, <span>0x1c</span>, <span>0xa6</span>, <span>0xb4</span>, <span>0xc6</span>,<br>    <span>0xe8</span>, <span>0xdd</span>, <span>0x74</span>, <span>0x1f</span>, <span>0x4b</span>, <span>0xbd</span>, <span>0x8b</span>, <span>0x8a</span>,<br>    <span>0x70</span>, <span>0x3e</span>, <span>0xb5</span>, <span>0x66</span>, <span>0x48</span>, <span>0x03</span>, <span>0xf6</span>, <span>0x0e</span>,<br>    <span>0x61</span>, <span>0x35</span>, <span>0x57</span>, <span>0xb9</span>, <span>0x86</span>, <span>0xc1</span>, <span>0x1d</span>, <span>0x9e</span>,<br>    <span>0xe1</span>, <span>0xf8</span>, <span>0x98</span>, <span>0x11</span>, <span>0x69</span>, <span>0xd9</span>, <span>0x8e</span>, <span>0x94</span>,<br>    <span>0x9b</span>, <span>0x1e</span>, <span>0x87</span>, <span>0xe9</span>, <span>0xce</span>, <span>0x55</span>, <span>0x28</span>, <span>0xdf</span>,<br>    <span>0x8c</span>, <span>0xa1</span>, <span>0x89</span>, <span>0x0d</span>, <span>0xbf</span>, <span>0xe6</span>, <span>0x42</span>, <span>0x68</span>,<br>    <span>0x41</span>, <span>0x99</span>, <span>0x2d</span>, <span>0x0f</span>, <span>0xb0</span>, <span>0x54</span>, <span>0xbb</span>, <span>0x16</span><br>};<br><br><span><span>void</span> <span>dummy_encrypt</span><span>()</span> </span>{<br>    <span>printf</span>(<span>"Testing AES S-Box...\n"</span>);<br>    <span>for</span> (<span>int</span> i = <span>0</span>; i &lt; <span>256</span>; i++) {<br>        <span>printf</span>(<span>"%x "</span>, aes_sbox[i]);<br>    }<br>    <span>printf</span>(<span>"\nEncryption done!\n"</span>);<br>}<br><span><span>int</span> <span>main</span><span>()</span> </span>{<br>    <span>dummy_encrypt</span>();<br>    <span>return</span> <span>0</span>;<br>}</span>
```

## 2\. Compile the Binary

Run this command in the terminal (Windows or Linux):

```
<span id="da1e" data-selectable-paragraph="">gcc test_crypto.<span>c</span> -o test_crypto.<span>exe</span></span>
```

## Testing

-   If no constants are found, make sure the plugin is correctly installed and YARA is operational.
-   You can try adding MD5 or SHA constants in the same manner for broader testing.

**Result:**  
The plugin detected:

![](https://miro.medium.com/v2/resize:fit:700/1*UQn5aWDeh0Ad1pXX1ktKng.png)

```
<span id="ed14" data-selectable-paragraph="">.<span>data</span>:<span>00404020</span>   Rijndael_AES_CHAR_404020<br>.<span>data</span>:<span>00404020</span>   Rijndael_AES_LONG_404020</span>
```

## Benefits for Malware Analysts

The FindCrypt3 plugin provides critical insights into malware functionality by revealing cryptographic constants embedded in binaries. Here are some of the key benefits:

**1\. Uncovering Encrypted Configurations:**  
Malware often encrypts its configuration files (C2 servers, payload URLs). By identifying AES or RC4 constants, analysts can extract and decrypt these configurations, allowing better detection and mitigation.

**2\. Reverse Engineering C2 Communication:**  
Encrypted C2 traffic can be decrypted by recognizing and replicating the cryptographic routines, facilitating deeper analysis of malware behavior.

**3\. Detecting Obfuscation and Anti-Analysis:**  
Malware frequently uses encryption to hide payloads or sensitive strings. FindCrypt3 detects these obfuscation techniques, allowing analysts to bypass them.

**4\. YARA Rule Creation:**  
Cryptographic constants are unique to many malware families. Extracting these constants enables the development of YARA rules, aiding in the detection of similar malware across systems.

**5\. Identifying Ransomware:**  
Ransomware relies heavily on encryption. Recognizing cryptographic functions early helps analysts identify potential ransomware samples, allowing for preemptive measures.

As a malware analyst, detecting cryptographic constants (like the AES S-Box) in malware binaries provides **valuable insights** into the malware’s behavior, capabilities, and goals. Here’s how this benefits you:

## Real-World Application (Case Study)

-   **Example:**
-   _Mirai Botnet_ used XOR encryption for configuration files. Analysts identified the XOR key using tools like `findcrypt`. This enabled researchers to decrypt configurations and take down infected IoT devices.
-   _LokiBot_ used AES to encrypt stolen credentials. Analysts traced the AES key by identifying S-Box constants, decrypting stolen data, and blocking the malware’s operation.

## Conclusion

The FindCrypt3 plugin is a must-have tool for malware analysts, offering deep insights into encryption methods used by malware. By overcoming initial installation challenges and leveraging the plugin effectively, analysts can unlock hidden secrets within malware binaries, gaining a strategic edge in cybersecurity operations.